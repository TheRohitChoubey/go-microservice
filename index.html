<!DOCTYPE html>
<html lang="en">

<head>
    <title>Vmware-Assignment</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="/app/client/client.js" type="text/javascript"></script>

    <script>
        let allAlbumNames = []
        let chosenAlbum
        let baseUrl = "http://localhost:80"
        allImageNames = []

        window.onload = () => {
            loadAlbums()
        }
        const createNewAlbum = () => {
            let albumName = document.getElementById("newAlbumName").value;
            let url = `${baseUrl}/createAlbum/${albumName}`;
            fetch(url)
                .then(res => res.json())
                .then(response => {
                    this.allAlbumNames = response
                    console.log(this.allAlbumNames)
                    loadAlbums()
                })

        }

        const loadAlbums = () => {
            let url = `${baseUrl}/getAllAlbums`;
            fetch(url)
                .then(res => res.json())
                .then(response => {
                    this.allAlbumNames = response
                    console.log(this.allAlbumNames)
                    this.chosenAlbum = ""
                    let allAlbumHtml = ""
                    for (let i = 0; i < this.allAlbumNames.length; i++) {
                        allAlbumHtml += `<button class="nav-link active" onclick="getAllImages('${this.allAlbumNames[i]}')"> ${this.allAlbumNames[i]}
                <button class="btn" onclick="deleteAlbum('${this.allAlbumNames[i]}')"><i class="fa fa-trash"></i></button>
            </button>`

                    }

                    document.getElementById('allAlbums').innerHTML = allAlbumHtml;

                })
        }

        const deleteAlbum = (albumName) => {
            let url = `${baseUrl}/deleteAlbum/${albumName}`;
            fetch(url)
                .then(res => res.json())
                .then(response => {
                    loadAlbums()
                })
        }

        const getAllImages = (albumName) => {
            let url = `${baseUrl}/getAllImages/${albumName}`;

            fetch(url)
                .then(res => res.json())
                .then(response => {
                    this.allImageNames = response
                    console.log(this.allImageNames)

                    let albumDivHtml = `<div class="col-6">
            <div class="card border-primary">
                <h6 class="card-header h2">Upload a new image to ${albumName} Album</h6>
                <div class="card-body text-success">
                    <div class="form-group">
                        <div class="row">
                            <div class="form-group">
                                <label for="inputEmail4" class="text-white">Choose the image to be uploaded ... </label>
                                <input class="form-control" type="file" id="imageFile" name="imageFile"><br><br>
                                <input type="button" onclick="submitImage('${albumName}')" value="Upload">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`

                    if (this.allImageNames != null) {
                        for (let i = 0; i < this.allImageNames.length; i++) {
                            albumDivHtml += `
            <div class="row">
                <div class="col-md-4">
                    <a class="thumbnail" target="_blank" href="${baseUrl}/getImageFromAlbum/${albumName}/${this.allImageNames[i]}"> ${this.allImageNames[i]}  Click here to open</a> 
                    <button class="btn" onclick="deleteImage('${this.allImageNames[i]}','${albumName}')"><i class="fa fa-trash"></i></button>
                </div>
            </div>`
                        }
                    }

                    document.getElementById('albumDiv').innerHTML = albumDivHtml;


                })
        }
        const deleteImage = (imageName, albumName) => {
            let url = `${baseUrl}/deleteImageFromAlbum/${albumName}/${imageName}`;
            fetch(url)
                .then(res => res.json())
                .then(response => {
                    getAllImages(albumName)
                })
        }

        const submitImage = (albumName) => {
            let input = document.getElementById("imageFile")
            let data = new FormData()
            data.append('file', input.files[0])

            let url = `${baseUrl}/uploadImage/${albumName}`;

            fetch(url, {
                    method: "POST",
                    body: data
                })
                .then(response => {
                    getAllImages(albumName)
                })

        }
    </script>

    <style>
        img {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            width: 150px;
        }
        
        img:hover {
            box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);
        }
    </style>

</head>

<body>

    <div>
        <div class="row">
            <div class="col-2">
                <div class="card border-primary">
                    <h6 class="card-header h2">Create An Album</h6>
                    <div class="card-body text-success">
                        <div class="form-group">
                            <div class="row">
                                <div class="form-group">
                                    <label for="inputEmail4" class="text-white">Enter an Album name ... </label>
                                    <input type="text" name="newAlbumName" id="newAlbumName" class="form-control" placeholder="Album Name">
                                    <input type="button" name="newAlbumNameButton" onclick="createNewAlbum()" class="btn btn-success btn-lg" value="Create new album" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <header>
                    <nav class="nav flex-column">
                        <div class="card border-primary">
                            <h6 class="card-header h2">All Albums</h6>
                            <div id="allAlbums">
                                <!-- all album Names -->

                            </div>
                        </div>
                    </nav>
                </header>
            </div>

            <div id="albumDiv" class="col-10">
                <!-- Image code  -->

            </div>
        </div>
    </div>

</body>

</html>